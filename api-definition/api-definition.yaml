openapi: "3.0.2"
info:
  title: Microblog API
  version: "0.5"
servers:
  - url: https://api.microblog.fi
    description: Microblogi palvelun rajapintakuvaus

components:
  responses:
    OK:
      description: OK

  schemas:
    Entry:
      description: Blog entry that hasn't assigned an id.
      type: object
      properties:
        date:
          type: string
          format: date
        header:
          type: string
          example: Blog entry header
        text:
          type: string
          example: Blog entry main text

    knownEntry:
      description: Blog entry that can be referred with an id.
      type: object
      properties:
        id:
          description: Blog entry id.
          type: integer
        date:
          type: string
          format: date
        header:
          type: string
          example: Blog entry header
        text:
          type: string
          example: Blog entry main text

    queryEntries:
      type: array
      items:
        type: integer
        description: List of blog entry ids.

    multipleFiles:
      type: array
      items:
        type: object
        properties:
          imagefile:
            type: string
            format: base64

    mediaRes:
      type: array
      items:
        type: object
        properties:
          fileUrl:
            type: string
            description: URL to access the media file.
          mimeType:
            type: string
            description: Mime type string for the media file.
          mediaId:
            type: string
            description: Uniqe id for media file.
          contextId:
            type: string
            description: The context media file is related to.
    userProfile:
      type: object
      required:
        - userId
        - atrObj
      properties:
        userId:
          type: string
          description: User uuid
        atrObj:
          type: object
          description: Profile attribute object.

tags:
  - name: blog
    description: Blog entry related functions.
  - name: media
    description: User media related functions.
  - name: portfolio
    description: User portfolio related functions.
  - name: usertags
    description: Tag-management related functions.
  - name: find
    description: Content searching related functions.
  - name: login
    description: User authentication related functions.
  - name: user
    description: User profile related functions.
paths:
  /blog/{userId}:
    x-router-controller: BlogController
    get:
      operationId: getBlogEntry
      tags:
        - blog
      summary: Get entries filtered by userId and optionally by date
      parameters:
        - in: path
          name: userId
          schema:
            type: string
          required: true

        - in: query
          name: searchString
          schema:
            type: string
      responses:
        "200":
          description: successfull operation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/knownEntry"

    post:
      operationId: addBlogEntry
      responses:
        "200":
          description: OK
      tags:
        - blog
      summary: Post new entry to the user's blog.
      parameters:
        - name: userId
          in: path
          schema:
            type: string
          required: true
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Entry"
    delete:
      operationId: deleteBlogEntry
      responses:
        "200":
          $ref: "#/components/responses/OK"
      tags:
        - blog
      summary: Delete one or several blog entries.
      parameters:
        - name: userId
          in: path
          schema:
            type: string
          required: true
        - name: postId
          in: query
          schema:
            $ref: "#/components/schemas/queryEntries"
          explode: false
          required: true

  /blog/{userId}/{postId}:
    put:
      operationId: updateBlogEntry
      responses:
        "200":
          $ref: "#/components/responses/OK"
      tags:
        - blog
      summary: Update blog entry.
      parameters:
        - name: userId
          in: path
          schema:
            type: string
          required: true
        - name: postId
          in: path
          schema:
            type: string
          required: true
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/knownEntry"

  /media/{userId}/{contextId}:
    x-router-controller: mediaController
    post:
      operationId: addUserMedia
      responses:
        "200":
          $ref: "#/components/responses/OK"
      tags:
        - media
      summary: Upload a media files to selected context.
      parameters:
        - name: userId
          required: true
          in: path
          schema:
            type: string

        - name: contextId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        description: Array of multipart/formdata in base64 encoding.
        content:
          multipart/formdata:
            schema:
              $ref: "#/components/schemas/multipleFiles"
            encoding:
              multipleFiles:
                contentType: image/png, image/jpeg

  /media/{userId}:
    get:
      operationId: getUserMedia
      summary: Get list of media files and their contexts.
      responses:
        "200":
          description: Response including user's media files.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/mediaRes"
      tags:
        - media
      parameters:
        - name: userId
          required: true
          in: path
          schema:
            type: string

  /media/{userId}/{mediaId}:
    delete:
      operationId: delUserMedia
      summary: Delete refered media file.
      tags:
        - media
      responses:
        "200":
          $ref: "#/components/responses/OK"
      parameters:
        - name: userId
          required: true
          in: path
          schema:
            type: string
        - name: mediaId
          required: true
          in: path
          schema:
            type: string

  /user/{userId}/profile:
    get:
      summary: Get user profile atributes.
      tags:
        - user
      responses:
        "200":
          $ref: "#/components/responses/OK"
      parameters:
        - name: userId
          required: true
          in: path
          schema:
            type: string
    patch:
      summary: Update user profile elements.
      tags:
        - user
      responses:
        "200":
          $ref: "#/components/responses/OK"
      parameters:
        - name: userId
          required: true
          in: path
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/userProfile"
